# Configuration for `tmux`
#
# See also: https://ianthehenry.com/posts/how-to-configure-tmux/
#
# Can inspect the default config with:
# ; tmux -f /dev/null list-keys 

# Purge all default bindings from key tables
unbind -a -T prefix
unbind -a -T root
unbind -a -T copy-mode
unbind -a -T copy-mode-vi

set -g prefix M-w
set -g mode-keys vi

# By default, 'Esc' is buffered for 500ms to capture escape sequences.
# We don't want this feature – and we want to move fast – so we disable it.
set -g escape-time 1

bind M-r source-file ~/.tmux.conf  # Reload the config
bind -T root M-Space copy-mode     # Enter 'copy' selection mode

# Session management
bind-key -T prefix d detach-client
bind-key -T root M-d detach-client  # Alias [M-w d] and [M-w M-d]

# Bindings for copy mode:
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi q      send -X cancel
# - navigation
bind -T copy-mode-vi k      send -X cursor-up
bind -T copy-mode-vi j      send -X cursor-down
bind -T copy-mode-vi h      send -X cursor-left
bind -T copy-mode-vi l      send -X cursor-right
bind -T copy-mode-vi B      send -X previous-space
bind -T copy-mode-vi b      send -X previous-word
bind -T copy-mode-vi W      send -X next-space
bind -T copy-mode-vi w      send -X next-word
bind -T copy-mode-vi E      send -X next-space-end
bind -T copy-mode-vi e      send -X next-word-end
bind -T copy-mode-vi ^      send -X back-to-indentation
bind -T copy-mode-vi 0      send -X start-of-line
bind -T copy-mode-vi \$     send -X end-of-line
bind -T copy-mode-vi \{     send -X previous-paragraph
bind -T copy-mode-vi \}     send -X next-paragraph
bind -T copy-mode-vi g      send -X history-top
bind -T copy-mode-vi G      send -X history-bottom
# - search
bind -T copy-mode-vi %      send -X next-matching-bracket
bind -T copy-mode-vi /      command-prompt -p "(search down)" "send -X search-forward \"%%%\""
bind -T copy-mode-vi ?      command-prompt -p "(search up)" "send -X search-backward \"%%%\""
bind -T copy-mode-vi n      send -X search-again
bind -T copy-mode-vi N      send -X search-reverse
# - registers
bind -T copy-mode-vi Space  if -F "#{selection_present}" { send -X clear-selection } { send -X begin-selection }
bind -T copy-mode-vi v      if -F "#{selection_present}" { send -X clear-selection } { send -X begin-selection }
bind -T copy-mode-vi V      send -X select-line
bind -T copy-mode-vi y      send -X copy-selection-no-clear
bind -T copy-mode-vi Enter  send -X copy-selection-and-cancel
# - modifiers
bind -T copy-mode-vi 1      command-prompt -N -I 1 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 2      command-prompt -N -I 2 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 3      command-prompt -N -I 3 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 4      command-prompt -N -I 4 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 5      command-prompt -N -I 5 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 6      command-prompt -N -I 6 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 7      command-prompt -N -I 7 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 8      command-prompt -N -I 8 -p (repeat) "send -N \"%%%\""
bind -T copy-mode-vi 9      command-prompt -N -I 9 -p (repeat) "send -N \"%%%\""

# Mouse support
set -g mouse on
bind -n WheelUpPane copy-mode -e  # Enter copy mode on scroll, but exit when scrolling past the bottom
bind -T copy-mode-vi WheelUpPane   send -X -N 5 scroll-up
bind -T copy-mode-vi WheelDownPane send -X -N 5 scroll-down
bind -n MouseDrag1Pane copy-mode -M  # Enter copy mode on click, with drag to make a selection
bind -T copy-mode-vi MouseDrag1Pane    send -X begin-selection
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-no-clear

# Bump the scrollback buffer (defaults to 2000)
set -g history-limit 200000

# Enable the status bar
set -g status off
set -g status-style fg=white,bg=black

# Enable 256-colour support (defaults to `screen` otherwise, restricting the colour palette)
# See https://github.com/zsh-users/zsh-autosuggestions/issues/229.
set -g default-terminal xterm-256color

